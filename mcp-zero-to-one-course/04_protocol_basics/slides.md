# ç¬¬å››ç« ï¼šMCP çš„é€šè¨Šæ–¹å¼ï¼ˆæŠ€è¡“åŸºç¤ï¼‰

---

## 1. ä¸‰ç¨®å‚³è¼¸å”è­°ç¸½è¦½

MCP æ”¯æ´ä¸‰ç¨®ä¸åŒçš„é€šè¨Šæ–¹å¼ï¼Œé©ç”¨æ–¼ä¸åŒå ´æ™¯ï¼š

| é¡å‹ | å”è­° | é©ç”¨å ´æ™¯ | å„ªé» | ç¼ºé» |
|------|------|----------|------|------|
| æœ¬æ©Ÿ | stdio | å¤§éƒ¨åˆ†æƒ…æ³ | ç°¡å–®ã€å®‰å…¨ | éœ€è¦æœ¬æ©Ÿç’°å¢ƒ |
| é ç«¯ | HTTP+SSE | èˆŠç‰ˆé ç«¯ | å³æ™‚æ¨æ’­ | éœ€ç¶­æŒé€£ç·š |
| é ç«¯ | Streamable HTTP | æ–°ç‰ˆé ç«¯ï¼ˆæ¨è–¦ï¼‰| ç„¡ç‹€æ…‹ã€æ˜“éƒ¨ç½² | è¼ƒæ–°ï¼Œæ”¯æ´åº¦å¾…æå‡ |

---

## 2. æœ¬æ©Ÿæ¨¡å¼ï¼šstdio è©³è§£

### é‹ä½œåŸç†
```
Client Process
    â†“ (spawn)
MCP Server Process
    â†“â†‘ (stdin/stdout)
JSON-RPC Messages
```

### å¯¦éš›æµç¨‹
1. **Client å•Ÿå‹• Server**ï¼šé€é child process åŸ·è¡Œ Python/Node è…³æœ¬
2. **å»ºç«‹é€šé“**ï¼šä½¿ç”¨æ¨™æº–è¼¸å…¥è¼¸å‡º (stdin/stdout) å‚³éè¨Šæ¯
3. **JSON-RPC æ ¼å¼**ï¼šæ‰€æœ‰è¨Šæ¯éƒ½æ˜¯ JSON-RPC 2.0 æ ¼å¼

### ç¯„ä¾‹é…ç½®ï¼ˆClaude Desktopï¼‰
```json
{
  "mcpServers": {
    "my-tool": {
      "command": "uv",
      "args": ["run", "my_server.py"]
    }
  }
}
```

---

## 3. JSON-RPC è¨Šæ¯æ ¼å¼

### è«‹æ±‚ (Request)
```json
{
  "jsonrpc": "2.0",
  "method": "tools/call",
  "params": {
    "name": "add",
    "arguments": {"a": 1, "b": 2}
  },
  "id": 1
}
```

### å›æ‡‰ (Response)
```json
{
  "jsonrpc": "2.0",
  "result": {
    "content": [
      {"type": "text", "text": "3"}
    ]
  },
  "id": 1
}
```

---

## 4. é ç«¯æ¨¡å¼ï¼šHTTP å”è­°

### 4.1 SSE (Server-Sent Events) æ¨¡å¼
- **ç‰¹é»**ï¼šå–®å‘æ¨æ’­ï¼Œéœ€è¦æŒçºŒé€£ç·š
- **ç”¨é€”**ï¼šServer ä¸»å‹•æ¨é€æ›´æ–°çµ¦ Client
- **é™åˆ¶**ï¼šé˜²ç«ç‰†ã€NAT ç©¿é€å•é¡Œ

### 4.2 Streamable HTTPï¼ˆæ¨è–¦ï¼‰
- **ç‰¹é»**ï¼šç„¡ç‹€æ…‹ã€RESTful é¢¨æ ¼
- **å„ªå‹¢**ï¼š
  - æ˜“æ–¼éƒ¨ç½²åœ¨é›²ç«¯ï¼ˆVercelã€Cloudflare Workersï¼‰
  - ä¸éœ€è¦ç¶­æŒé•·é€£ç·š
  - æ”¯æ´æ¨™æº– HTTP ä¸­ä»‹è»Ÿé«”ï¼ˆå¿«å–ã€è² è¼‰å¹³è¡¡ï¼‰

### ç¯„ä¾‹ï¼šStreamable HTTP Endpoint
```python
# Server ç«¯é»é…ç½®
@app.post("/mcp/v1/messages")
async def handle_message(request: dict):
    # è™•ç† JSON-RPC è«‹æ±‚
    return JSONResponse(response)
```

---

## 5. é€£ç·šç”Ÿå‘½é€±æœŸ

### åˆå§‹åŒ–éšæ®µ
1. **Client é€£æ¥**ï¼šå»ºç«‹é€šè¨Šé€šé“
2. **èƒ½åŠ›å”å•†**ï¼šäº¤æ›æ”¯æ´çš„åŠŸèƒ½
3. **å·¥å…·ç™¼ç¾**ï¼šClient æŸ¥è©¢å¯ç”¨çš„ Tools/Resources/Prompts

### åŸ·è¡Œéšæ®µ
```
Client â†’ Server: initialize
Server â†’ Client: capabilities
Client â†’ Server: tools/list
Server â†’ Client: [tool1, tool2, ...]
Client â†’ Server: tools/call
Server â†’ Client: result
```

### çµ‚æ­¢éšæ®µ
- Client ç™¼é€ shutdown è«‹æ±‚
- Server æ¸…ç†è³‡æºå¾Œé—œé–‰

---

## 6. å¯¦ä½œè€ƒé‡èˆ‡æœ€ä½³å¯¦è¸

### é¸æ“‡å”è­°çš„æ±ºç­–æ¨¹
```
éœ€è¦é ç«¯å­˜å–ï¼Ÿ
â”œâ”€ å¦ â†’ stdioï¼ˆæ¨è–¦ï¼‰
â””â”€ æ˜¯ â†’ éœ€è¦å³æ™‚æ¨æ’­ï¼Ÿ
    â”œâ”€ æ˜¯ â†’ SSE
    â””â”€ å¦ â†’ Streamable HTTPï¼ˆæ¨è–¦ï¼‰
```

### éŒ¯èª¤è™•ç†
- ä½¿ç”¨æ¨™æº– JSON-RPC éŒ¯èª¤ç¢¼
- å¯¦ä½œé‡è©¦æ©Ÿåˆ¶
- è¨˜éŒ„é€šè¨Šæ—¥èªŒä»¥ä¾¿é™¤éŒ¯

### å®‰å…¨æ€§è€ƒé‡
- stdioï¼šä¾è³´ä½œæ¥­ç³»çµ±æ¬Šé™æ§åˆ¶
- HTTPï¼šå¯¦ä½œèªè­‰æ©Ÿåˆ¶ï¼ˆBearer Tokenã€API Keyï¼‰
- åŠ å¯†ï¼šä½¿ç”¨ TLS/HTTPS

---

## æœ¬ç« å°çµ

1. **stdio** æ˜¯æœ€ç°¡å–®ä¸”å®‰å…¨çš„é¸é …ï¼Œé©åˆæœ¬æ©Ÿé–‹ç™¼
2. **Streamable HTTP** æ˜¯é ç«¯éƒ¨ç½²çš„æœ€ä½³é¸æ“‡
3. æ‰€æœ‰é€šè¨Šéƒ½åŸºæ–¼ **JSON-RPC 2.0** æ¨™æº–
4. é¸æ“‡å”è­°æ™‚è€ƒæ…®ï¼šéƒ¨ç½²ç’°å¢ƒã€å®‰å…¨éœ€æ±‚ã€å³æ™‚æ€§è¦æ±‚

ğŸ‘‰ **ä¸‹ä¸€ç« ï¼šå‹•æ‰‹åšç¬¬ä¸€å€‹ MCP Server**